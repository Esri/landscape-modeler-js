/*!
 *  landscape-modeler-js
 *  @version 0.1.0
 *  @author Tom Wayson <twayson@esri.com> (http://tomwayson.com)
 *
 *  A web application for designing, running, and saving weighted overlay models using the Esri ArcGIS API for JavaScript and ArcGIS Server image services.
 */
define(["dojo/_base/declare","dojo/_base/array","dojo/on","dojo/Evented","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_Container","dijit/form/DropDownButton","dijit/DropDownMenu","dijit/MenuItem","esri/layers/RasterFunction","./containerUtils","./WeightedOverlayLayerEditor","./Colormap","dojo/text!./templates/WeightedOverlayModelDesigner.html","dijit/form/Button","dijit/form/HorizontalSlider","dijit/form/CheckBox"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a([f,g,h,i,d],{templateString:q,baseClass:"weighted-overlay-model-designer",_isValid:!1,buildRendering:function(){this.inherited(arguments),this.colormap=new p({},this.colorMapNode),this.ColormapSelector=new j({label:"Color Ramp"},this.colormapSelectorNode)},postCreate:function(){var a=this,b=this.sliderNode;c(b,"change",function(){a.weightedOverlayService&&a.weightedOverlayService.imageServiceLayer&&a.weightedOverlayService.imageServiceLayer.setOpacity(1-b.value)});var d=this.visibleModelNode;c(d,"Change",function(){a.weightedOverlayService&&a.weightedOverlayService.imageServiceLayer&&a.weightedOverlayService.imageServiceLayer.setVisibility(d.checked),b.disabled=!d.checked}),b.set("value",0),d.set("checked",!1)},_setModelAttr:function(a){this.setModel(a)},_setWeightedOverlayServiceAttr:function(a){this.setWeightedOverlayService(a)},startup:function(){this.inherited(arguments),this.validate()},setWeightedOverlayService:function(a){var d=this;this.weightedOverlayService=a;var e=new k({style:"display: none;"});b.forEach(this.weightedOverlayService.colormapDefinitions,function(a){var b=new l;new p({definition:a}).placeAt(b.containerNode),d.own(c(b,"Click",function(){d.colormap&&d.colormap.definition!==a&&d.colormap.set("definition",a),d.model.colormapDefinition=a,d.runModel()})),e.addChild(b)}),this.ColormapSelector.set("dropDown",e)},_onRunClick:function(){this.runModel()},setModel:function(a){var d=this;this.model=a,n.removeChildren(this),b.forEach(this.model.overlayLayers,function(a){var b=new o({overlayLayer:a});d.own(c(b,"WeightChange",function(){d.validate()})),b.startup(),d.addChild(b)}),this.validate(),this.colormap.set("definition",this.model.colormapDefinition)},validate:function(){var a=0;this.model&&this.model.overlayLayers&&b.forEach(this.model.overlayLayers,function(b){a+=b.weight}),this.weightTotalNode.innerHTML=a,100===a?(this._isValid=!0,e.remove(this.weightTotalWrapper,"validation-error")):(this._isValid=!1,e.add(this.weightTotalWrapper,"validation-error")),this.runModelButton.set("disabled",!this._isValid)},runModel:function(){this.validate(),this._isValid&&(this.weightedOverlayService.runModel(this.model),this.showModelLayer(),this.emit("model-run",this.model))},showModelLayer:function(){this.visibleModelNode.set("checked",!0)}})});