/*!
 *  landscape-modeler-js
 *  @version 0.1.0
 *  @author Tom Wayson <twayson@esri.com> (http://tomwayson.com)
 *
 *  A web application for designing, running, and saving weighted overlay models using the Esri ArcGIS API for JavaScript and ArcGIS Server image services.
 */
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-style","dojo/dom-class","dojo/number","dojo/string","dojo/Evented","dojo/_base/fx","dojo/fx","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_Container","./containerUtils","dojo/text!./templates/RemapRangeEditor.html","dojo/text!./templates/WeightedOverlayLayerEditor.html","dijit/form/Button","dijit/form/NumberTextBox","dijit/form/HorizontalSlider"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=function(a){var b;return b=a.inputMin===a.inputMax?a.inputMin+"":a.inputMin+" - "+a.inputMax},w=a([l,m,n,i],{templateString:q,baseClass:"reclass-range-editor",_setRemapRangeAttr:function(a){var b=" ("+v(a)+")";this.labelNode.innerHTML=a.label.substr(0,14)+(a.label.length>15?"&hellip;":"")+b,this.labelNode.title=a.label+b,this.outputValueNode.set("value",a.outputValue)},postCreate:function(){var a=this;this.inherited(arguments),this.outputValueNode.set("constraints",{round:0}),this.sliderObject=new u({name:"slider",value:this.outputValueNode.value,minimum:0,maximum:9,intermediateChanges:!0,discreteValues:10,style:"width: 100px;"},this.slider),this.sliderObject.startup(),this.own(d(this.sliderObject,"Change",function(b){a.outputValueNode.set("value",b)})),this.own(d(this.outputValueNode,"Change",function(b){a.remapRange.outputValue=b,a.sliderObject.set("value",b)}))},setOutputRange:function(a,b){var c=this.outputValueNode,d=h.substitute("Value must be between ${0} and ${1}",[a,b]);c.set("constraints",{min:a,max:b}),c.set("rangeMessage",d),this.sliderObject.set({minimum:a,maximum:b})}}),x=a([l,m,o,i],{templateString:'<div><table class="${baseClass}-table"><tbody data-dojo-attach-point="containerNode"></tbody></table></div>',minOutputValue:0,maxOutputValue:0,baseClass:"remap-ranges-editor",_setRemapRangesAttr:function(a){var b,d=this;p.removeChildren(this),c.forEach(a,function(a){a.label||(a.label=a.inputMin+" - "+a.inputMax),b=new w({remapRange:a}),b.setOutputRange(d.minOutputValue,d.maxOutputValue),d.addChild(b)})},getRemapRanges:function(){var a=[];return c.forEach(this.getChildren(),function(b){a.push(b.getRemapRange())}),a}});return a([l,m,n,o,i],{templateString:r,baseClass:"weighted-overlay-layer-editor",_setOverlayLayerAttr:function(a){var b=this;this.weightNode.set("value",a.weight),this.labelNode.innerHTML=a.title,this.remapRangesEditor=new x({minOutputValue:0,maxOutputValue:9,remapRanges:a.remapRanges},b.remapRangesEditorContainer)},postCreate:function(){this.inherited(arguments),this.attachWeightingToggle()},attachWeightingToggle:function(){e.set(this.remapRangesEditorWrapper,"display","none"),this.own(d(this.layerNode,"click",b.hitch(this,function(){f.contains(this.iconNode,"icon-chevron-right")?k.wipeIn({node:this.remapRangesEditorWrapper,onEnd:b.hitch(this,function(){f.replace(this.iconNode,"icon-chevron-down","icon-chevron-right")})}).play():k.wipeOut({node:this.remapRangesEditorWrapper,onEnd:b.hitch(this,function(){f.replace(this.iconNode,"icon-chevron-right","icon-chevron-down")})}).play()})))},isValid:function(){return this.weightNode.isValid()},_onWeightChange:function(){var a=parseInt(this.weightNode.valueNode.value,10);a=isNaN(a)?0:a,this.overlayLayer.weight=a,this.emit("WeightChange",a)},_onFocus:function(){this.weightNode.focusNode.select()},_onBlur:function(){var a=parseInt(this.weightNode.valueNode.value,10);isNaN(a)&&(this.weightNode.value=0,this.emit("WeightChange",a))}})});